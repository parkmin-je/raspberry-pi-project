{% extends "base.html" %}

{% block title %}{{ profile_user.name }} (@{{ profile_user.username }}) / Twitter{% endblock %}

{% block content %}
<div class="twitter-container">
    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
    <div class="left-sidebar">
        <a href="{{ url_for('timeline') }}" class="logo">
            ğŸ¦
        </a>
        
        <nav>
            <a href="{{ url_for('timeline') }}" class="nav-item">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-text">í™ˆ</span>
            </a>
            
            <a href="{{ url_for('users_list') }}" class="nav-item">
                <span class="nav-icon">ğŸ‘¥</span>
                <span class="nav-text">ì‚¬ìš©ì</span>
            </a>
            
            <a href="{{ url_for('profile') }}" class="nav-item">
                <span class="nav-icon">ğŸ‘¤</span>
                <span class="nav-text">í”„ë¡œí•„</span>
            </a>
            
            <a href="{{ url_for('logout') }}" class="nav-item">
                <span class="nav-icon">ğŸšª</span>
                <span class="nav-text">ë¡œê·¸ì•„ì›ƒ</span>
            </a>
        </nav>
    </div>
    
    <!-- ì¤‘ì•™ í”¼ë“œ -->
    <div class="main-feed">
        <div class="feed-header">
            <div style="display: flex; align-items: center; gap: 32px;">
                <button onclick="history.back()" style="background: none; border: none; font-size: 20px; cursor: pointer; padding: 8px; border-radius: 50%; transition: background 0.2s;">â†</button>
                <div>
                    <div style="font-size: 20px; font-weight: bold;">{{ profile_user.name }}</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">{{ tweets|length }} íŠ¸ìœ—</div>
                </div>
            </div>
        </div>
        
        <!-- í”„ë¡œí•„ í—¤ë” -->
        <div style="height: 200px; background: linear-gradient(135deg, var(--twitter-blue), #1A91DA);"></div>
        
        <!-- í”„ë¡œí•„ ì •ë³´ -->
        <div style="padding: 16px; border-bottom: 1px solid var(--border-color);">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-top: -67px; margin-bottom: 12px;">
                <div class="avatar" style="width: 134px; height: 134px; font-size: 48px; border: 4px solid white;">
                    {{ profile_user.name[0] if profile_user.name else 'U' }}
                </div>
                
                {% if user.id != profile_user.id %}
                <div style="margin-top: 67px;">
                    {% if user.is_following(profile_user) %}
                    <button id="followButton" class="following-button" onclick="toggleFollow()" style="padding: 8px 16px; border-radius: 9999px; font-weight: bold; cursor: pointer;">
                        íŒ”ë¡œì‰
                    </button>
                    {% else %}
                    <button id="followButton" class="follow-button" onclick="toggleFollow()" style="padding: 8px 16px; border-radius: 9999px; font-weight: bold; cursor: pointer;">
                        íŒ”ë¡œìš°
                    </button>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            
            <div style="margin-bottom: 12px;">
                <h2 style="font-size: 20px; font-weight: bold;">{{ profile_user.name }}</h2>
                <p style="color: var(--text-secondary); font-size: 15px;">@{{ profile_user.username }}</p>
            </div>
            
            {% if profile_user.profile %}
            <p style="margin-bottom: 12px; font-size: 15px;">{{ profile_user.profile }}</p>
            {% endif %}
            
            <div style="display: flex; gap: 8px; color: var(--text-secondary); font-size: 15px; margin-bottom: 12px;">
                <span>ğŸ“…</span>
                <span>{{ profile_user.created_at.strftime('%Yë…„ %mì›”') }}ì— ê°€ì…í•¨</span>
            </div>
            
            <div style="display: flex; gap: 20px; font-size: 14px;">
                <div>
                    <strong style="color: var(--text-primary); font-weight: bold;">{{ profile_user.following.count() }}</strong>
                    <span style="color: var(--text-secondary);"> íŒ”ë¡œì‰</span>
                </div>
                <div>
                    <strong style="color: var(--text-primary); font-weight: bold;">{{ profile_user.followers.count() }}</strong>
                    <span style="color: var(--text-secondary);"> íŒ”ë¡œì›Œ</span>
                </div>
            </div>
        </div>
        
        <!-- íƒ­ -->
        <div class="tabs">
            <div class="tab active">íŠ¸ìœ—</div>
            <div class="tab">ë‹µê¸€</div>
            <div class="tab">ë¯¸ë””ì–´</div>
        </div>
        
        <!-- íŠ¸ìœ— ëª©ë¡ -->
        <div>
            {% if tweets %}
                {% for tweet in tweets %}
                <div class="tweet-card">
                    <div class="tweet-content-wrapper">
                        <div class="avatar">
                            {{ profile_user.name[0] if profile_user.name else 'U' }}
                        </div>
                        
                        <div class="tweet-body">
                            <div class="tweet-header">
                                <span class="tweet-author">{{ profile_user.name }}</span>
                                <span class="tweet-username">@{{ profile_user.username }}</span>
                                <span class="tweet-dot">Â·</span>
                                <span class="tweet-time">{{ tweet.created_at.strftime('%mì›” %dì¼') }}</span>
                            </div>
                            
                            <div class="tweet-text">
                                {{ tweet.content }}
                            </div>
                            
                            <div class="tweet-actions">
                                <button class="action-button reply">
                                    <span class="icon">ğŸ’¬</span>
                                </button>
                                <button class="action-button retweet">
                                    <span class="icon">ğŸ”</span>
                                </button>
                                <button class="action-button like">
                                    <span class="icon">ğŸ¤</span>
                                </button>
                                <button class="action-button">
                                    <span class="icon">ğŸ“¤</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                    <h3 style="margin-bottom: 8px;">ì•„ì§ íŠ¸ìœ—ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p>@{{ profile_user.username }}ë‹˜ì´ íŠ¸ìœ—í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” -->
    <div class="right-sidebar">
        <div class="search-box">
            <input type="text" class="search-input" placeholder="Twitter ê²€ìƒ‰">
        </div>
    </div>
</div>

<script>
let isFollowing = {{ 'true' if user.is_following(profile_user) else 'false' }};

async function toggleFollow() {
    const button = document.getElementById('followButton');
    button.disabled = true;
    
    const endpoint = isFollowing ? '/api/unfollow/{{ profile_user.id }}' : '/api/follow/{{ profile_user.id }}';
    
    try {
        const response = await fetch(endpoint, { 
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        if (response.ok) {
            isFollowing = !isFollowing;
            
            if (isFollowing) {
                button.textContent = 'íŒ”ë¡œì‰';
                button.className = 'following-button';
            } else {
                button.textContent = 'íŒ”ë¡œìš°';
                button.className = 'follow-button';
            }
            
            // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ íŒ”ë¡œì›Œ ìˆ˜ ì—…ë°ì´íŠ¸
            setTimeout(() => location.reload(), 500);
        } else {
            alert('ì‘ì—… ì‹¤íŒ¨');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
    } finally {
        button.disabled = false;
    }
}
</script>
{% endblock %}
