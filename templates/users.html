{% extends "base.html" %}

{% block title %}ì‚¬ìš©ì ì°¾ê¸° / Twitter{% endblock %}

{% block content %}
<div class="twitter-container">
    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
    <div class="left-sidebar">
        <a href="{{ url_for('timeline') }}" class="logo">
            ğŸ¦
        </a>
        
        <nav>
            <a href="{{ url_for('timeline') }}" class="nav-item">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-text">í™ˆ</span>
            </a>
            
            <a href="{{ url_for('users_list') }}" class="nav-item active">
                <span class="nav-icon">ğŸ‘¥</span>
                <span class="nav-text">ì‚¬ìš©ì</span>
            </a>
            
            <a href="{{ url_for('profile') }}" class="nav-item">
                <span class="nav-icon">ğŸ‘¤</span>
                <span class="nav-text">í”„ë¡œí•„</span>
            </a>
            
            <a href="{{ url_for('logout') }}" class="nav-item">
                <span class="nav-icon">ğŸšª</span>
                <span class="nav-text">ë¡œê·¸ì•„ì›ƒ</span>
            </a>
        </nav>
        
        <button class="tweet-button" onclick="location.href='{{ url_for('timeline') }}'">
            <span class="nav-text">íŠ¸ìœ—í•˜ê¸°</span>
            <span class="nav-icon" style="display: none;">âœï¸</span>
        </button>
    </div>
    
    <!-- ì¤‘ì•™ í”¼ë“œ -->
    <div class="main-feed">
        <div class="feed-header">
            ì‚¬ìš©ì ì°¾ê¸°
        </div>
        
        <!-- ì‚¬ìš©ì ëª©ë¡ -->
        <div>
            {% if all_users %}
                {% for profile_user in all_users %}
                <div class="tweet-card" style="border-bottom: 1px solid var(--border-color);">
                    <div class="tweet-content-wrapper">
                        <div class="avatar">
                            {{ profile_user.name[0] if profile_user.name else 'U' }}
                        </div>
                        
                        <div class="tweet-body">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1; cursor: pointer;" onclick="location.href='{{ url_for('user_profile', username=profile_user.username) }}'">
                                    <div class="tweet-author" style="margin-bottom: 2px;">{{ profile_user.name }}</div>
                                    <div class="tweet-username">@{{ profile_user.username }}</div>
                                    {% if profile_user.profile %}
                                    <p style="margin-top: 8px; font-size: 15px; color: var(--text-primary);">{{ profile_user.profile }}</p>
                                    {% endif %}
                                </div>
                                
                                <div>
                                    {% if user.is_following(profile_user) %}
                                    <button class="following-button" onclick="unfollowUser({{ profile_user.id }}, this)" style="padding: 8px 16px; border-radius: 9999px; font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.2s;">
                                        íŒ”ë¡œì‰
                                    </button>
                                    {% else %}
                                    <button class="follow-button" onclick="followUser({{ profile_user.id }}, this)" style="padding: 8px 16px; border-radius: 9999px; font-size: 14px; font-weight: bold; cursor: pointer;">
                                        íŒ”ë¡œìš°
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ‘¥</div>
                    <h3 style="margin-bottom: 8px;">ì•„ì§ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p>ê³§ ìƒˆë¡œìš´ ì‚¬ëŒë“¤ì´ ê°€ì…í•  ê±°ì˜ˆìš”!</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” -->
    <div class="right-sidebar">
        <div class="search-box">
            <input type="text" class="search-input" placeholder="ì‚¬ìš©ì ê²€ìƒ‰" id="userSearch">
        </div>
        
        <div class="widget">
            <div class="widget-header">
                ì¶”ì²œ ì‚¬ìš©ì
            </div>
            {% if all_users[:3] %}
                {% for profile_user in all_users[:3] %}
                <div class="widget-item">
                    <div class="user-item">
                        <div class="user-info">
                            <div class="avatar" style="width: 40px; height: 40px; font-size: 16px;">
                                {{ profile_user.name[0] if profile_user.name else 'U' }}
                            </div>
                            <div>
                                <div class="user-name">{{ profile_user.name }}</div>
                                <div style="color: var(--text-secondary); font-size: 14px;">@{{ profile_user.username }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</div>

<script>
async function followUser(userId, button) {
    button.disabled = true;
    button.textContent = 'ì²˜ë¦¬ ì¤‘...';
    
    try {
        const response = await fetch(`/api/follow/${userId}`, { 
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        if (response.ok) {
            button.textContent = 'íŒ”ë¡œì‰';
            button.className = 'following-button';
            button.onclick = () => unfollowUser(userId, button);
        } else {
            alert('íŒ”ë¡œìš° ì‹¤íŒ¨');
            button.disabled = false;
            button.textContent = 'íŒ”ë¡œìš°';
        }
    } catch (error) {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
        button.disabled = false;
        button.textContent = 'íŒ”ë¡œìš°';
    }
}

async function unfollowUser(userId, button) {
    button.disabled = true;
    button.textContent = 'ì²˜ë¦¬ ì¤‘...';
    
    try {
        const response = await fetch(`/api/unfollow/${userId}`, { 
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        if (response.ok) {
            button.textContent = 'íŒ”ë¡œìš°';
            button.className = 'follow-button';
            button.onclick = () => followUser(userId, button);
        } else {
            alert('ì–¸íŒ”ë¡œìš° ì‹¤íŒ¨');
            button.disabled = false;
            button.textContent = 'íŒ”ë¡œì‰';
        }
    } catch (error) {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
        button.disabled = false;
        button.textContent = 'íŒ”ë¡œì‰';
    }
}

// ì‚¬ìš©ì ê²€ìƒ‰ í•„í„°
document.getElementById('userSearch').addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    const userCards = document.querySelectorAll('.tweet-card');
    
    userCards.forEach(card => {
        const text = card.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
});
</script>
{% endblock %}
