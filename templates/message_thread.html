{% extends "base.html" %}

{% block title %}{{ other_user.name }}ë‹˜ê³¼ì˜ ëŒ€í™” / Twitter{% endblock %}

{% block content %}
<div class="twitter-container">
    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
    <div class="left-sidebar">
        <a href="{{ url_for('timeline') }}" class="logo">ğŸ¦</a>
        
        <nav>
            <a href="{{ url_for('timeline') }}" class="nav-item">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-text">í™ˆ</span>
            </a>
            
            <a href="{{ url_for('messages') }}" class="nav-item active">
                <span class="nav-icon">âœ‰ï¸</span>
                <span class="nav-text">ìª½ì§€</span>
            </a>
        </nav>
    </div>
    
    <!-- ì¤‘ì•™ í”¼ë“œ -->
    <div class="main-feed">
        <div class="feed-header">
            <div style="display: flex; align-items: center; gap: 16px;">
                <button onclick="location.href='{{ url_for('messages') }}'" style="background: none; border: none; font-size: 20px; cursor: pointer; padding: 8px; border-radius: 50%;">â†</button>
                <div>
                    <div style="font-weight: bold;">{{ other_user.name }}</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">@{{ other_user.username }}</div>
                </div>
            </div>
        </div>
        
        <div id="messagesList" style="flex: 1; overflow-y: auto; padding: 16px;">
            {% for msg in messages %}
            <div style="margin-bottom: 16px; display: flex; {% if msg.sender_id == user.id %}justify-content: flex-end;{% endif %}">
                <div style="max-width: 70%; padding: 12px 16px; border-radius: 16px; {% if msg.sender_id == user.id %}background: var(--twitter-blue); color: white;{% else %}background: var(--bg-secondary);{% endif %}">
                    {{ msg.content }}
                    <div style="font-size: 11px; margin-top: 4px; opacity: 0.7;">
                        {{ msg.created_at.strftime('%H:%M') }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div style="padding: 16px; border-top: 1px solid var(--border-color);">
            <div style="display: flex; gap: 12px;">
                <input type="text" id="messageInput" placeholder="ìª½ì§€ ì…ë ¥" style="flex: 1; padding: 12px; border: 1px solid var(--border-color); border-radius: 9999px; outline: none;">
                <button onclick="sendMessage()" class="post-button">ì „ì†¡</button>
            </div>
        </div>
    </div>
    
    <!-- ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” -->
    <div class="right-sidebar">
        <div class="widget">
            <div class="widget-header">í”„ë¡œí•„</div>
            <div class="widget-item" style="text-align: center;">
                <div class="avatar" style="width: 72px; height: 72px; font-size: 32px; margin: 0 auto 12px;">
                    {{ other_user.name[0] if other_user.name else 'U' }}
                </div>
                <div style="font-weight: bold; font-size: 17px;">{{ other_user.name }}</div>
                <div style="color: var(--text-secondary); margin-bottom: 12px;">@{{ other_user.username }}</div>
                <button onclick="location.href='{{ url_for('user_profile', username=other_user.username) }}'" class="btn" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 9999px;">
                    í”„ë¡œí•„ ë³´ê¸°
                </button>
            </div>
        </div>
    </div>
</div>

<script>
async function sendMessage() {
    const input = document.getElementById('messageInput');
    const content = input.value.trim();
    if (!content) return;
    
    try {
        const response = await fetch('/api/send_message/{{ other_user.id }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ content })
        });
        
        if (response.ok) {
            location.reload();
        }
    } catch (error) {
        console.error('Error:', error);
        alert('ë©”ì‹œì§€ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    }
}

document.getElementById('messageInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        sendMessage();
    }
});

// ë©”ì‹œì§€ ëª©ë¡ì„ ë§¨ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
document.getElementById('messagesList').scrollTop = document.getElementById('messagesList').scrollHeight;
</script>
{% endblock %}
