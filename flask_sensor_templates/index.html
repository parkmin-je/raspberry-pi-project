<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì„¼ì„œ ëŒ€ì‹œë³´ë“œ</title>
    <meta http-equiv="refresh" content="10">
    <style>
        body  { font-family: sans-serif; margin: 40px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 8px 12px; text-align: center; }
        th    { background-color: #4472C4; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        .stats { display:flex; gap:40px; margin-bottom:20px; }
        .stat-box { background:#f0f4ff; padding:16px 24px; border-radius:8px; text-align:center; }
        .alert-box { background:#FF4444; color:white; padding:12px; font-size:1.2em; margin-bottom:16px; border-radius:6px; }
        .hot  { background-color: #FFCCCC; }
        .cold { background-color: #CCE5FF; }
        .good { background-color: #CCFFCC; }
    </style>
</head>
<body>
    <h1>ğŸŒ¡ï¸ DHT11 ì„¼ì„œ ëŒ€ì‹œë³´ë“œ</h1>

    {% if alert %}
    <div class="alert-box">
        âš ï¸ ê²½ë³´! í˜„ì¬ ì˜¨ë„ê°€ {{ limit }}Â°Cë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤!
    </div>
    {% endif %}

    {% if records %}
    <div class="stats">
        <div class="stat-box">
            <strong>ì´ ì¸¡ì • íšŸìˆ˜</strong><br>
            {{ records | length }} íšŒ
        </div>
        <div class="stat-box">
            <strong>ìµœê·¼ ì˜¨ë„</strong><br>
            {{ records[0].temperature }} Â°C
        </div>
        <div class="stat-box">
            <strong>ìµœê·¼ ìŠµë„</strong><br>
            {{ records[0].humidity }} %
        </div>
        <div class="stat-box">
            <strong>í‰ê·  ì˜¨ë„</strong><br>
            {{ stats.avg_temp | round(1) }} Â°C
        </div>
        <div class="stat-box">
            <strong>ìµœê³  ì˜¨ë„</strong><br>
            {{ stats.max_temp }} Â°C
        </div>
        <div class="stat-box">
            <strong>ìµœì € ì˜¨ë„</strong><br>
            {{ stats.min_temp }} Â°C
        </div>
    </div>

    <p>
        <a href="/collect">ğŸ“¥ ì§€ê¸ˆ ë°ì´í„° ìˆ˜ì§‘</a> |
        <a href="/analysis">ğŸ“Š ì‹œê°„ëŒ€ë³„ ë¶„ì„</a>
    </p>

    <table>
        <tr>
            <th>ID</th>
            <th>ì˜¨ë„ (Â°C)</th>
            <th>ìŠµë„ (%)</th>
            <th>ìƒíƒœ</th>
            <th>ì¸¡ì • ì‹œê°</th>
        </tr>
        {% for row in records %}
        <tr class="{% if row.temperature >= 28 %}hot{% elif row.temperature <= 20 %}cold{% else %}good{% endif %}">
            <td>{{ row.id }}</td>
            <td>{{ row.temperature }}</td>
            <td>{{ row.humidity }}</td>
            <td>
                {% if row.temperature >= 28 %}
                    ğŸ”´ ë”ì›€
                {% elif row.temperature <= 20 %}
                    ğŸ”µ ì¶”ì›€
                {% else %}
                    ğŸŸ¢ ì¾Œì 
                {% endif %}
            </td>
            <td>{{ row.measured_at }}</td>
        </tr>
        {% endfor %}
    </table>

    <canvas id="myChart" width="800" height="300" style="margin-top:30px;"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    fetch('/api/chart')
        .then(res => res.json())
        .then(data => {
            new Chart(document.getElementById('myChart'), {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'ì˜¨ë„ (Â°C)',
                            data: data.temperatures,
                            borderColor: 'red',
                            fill: false
                        },
                        {
                            label: 'ìŠµë„ (%)',
                            data: data.humidities,
                            borderColor: 'blue',
                            fill: false
                        }
                    ]
                }
            });
        });
    </script>

    {% else %}
        <p>ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ„ ë§í¬ë¥¼ ëˆŒëŸ¬ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì„¸ìš”.</p>
    {% endif %}

</body>
</html>